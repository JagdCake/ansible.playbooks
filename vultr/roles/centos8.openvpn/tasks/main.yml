---
- name: install OpenVPN
  yum:
    name: openvpn
    state: installed

# makes sure there is no timezone mismatch when the client
# checks the timestamp on the certificate generated by the server
# prevents certificate's not working
- name: align the server timezone with the client timezone
  timezone:
    name: "{{ my_timezone }}"

# download EasyRSA
# utility used to generate and sign PKI certificates used by OpenVPN
- name: download EasyRSA
  get_url:
    url: https://github.com/OpenVPN/easy-rsa/releases/download/v3.0.6/EasyRSA-unix-v3.0.6.tgz
    dest: /etc/openvpn/easyrsa.tgz
  register: download

- name: install tar
  yum:
    name: tar
    state: installed

- name: unarchive EasyRSA
  unarchive:
    remote_src: yes
    src: "{{ download.dest }}"
    dest: /etc/openvpn
    # makes the list of unarchived files accessible to the registered variable
    list_files: yes
  register: easyrsa

- name: make me an owner of the EasyRSA directory
  file:
    # the first file in the list is the root EasyRSA directory
    path: "/etc/openvpn/{{ easyrsa.files[0] }}"
    state: directory
    owner: "{{ username }}"
    group: "{{ username }}"
    mode: 0740
    recurse: yes

- name: delete the EasyRSA archive
  file:
    path: "{{ download.dest }}"
    state: absent
...
